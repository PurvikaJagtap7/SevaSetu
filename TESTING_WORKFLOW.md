# Testing Workflow - Complete User Journey

## Test Scenario 1: Submit Grievance and Track as Admin

### Step 1: Submit a Grievance as Citizen

1. **Open browser:** `http://localhost:3000`

2. **Login as citizen:**
   - Click "Login"
   - Email: `ramesh@example.com`
   - Password: `password123`
   - Type: User/Citizen
   - Click "Login"

3. **Submit grievance:**
   - Click "Submit Grievance"
   - Fill form:
     ```
     WhatsApp Number: +919876543210
     City: Mumbai
     State: Maharashtra
     Place: Andheri West
     Area: SV Road
     Grievance: There is a water leakage in the main pipeline near the market. 
                The water is flowing on the road for the past 3 days. 
                This is causing inconvenience to pedestrians and vehicles.
     ```
   - Optionally upload an image
   - Click "Process Grievance"

4. **Note the Grievance ID** (e.g., GRV123456)

**Expected Result:**
- ✅ Success message with Grievance ID
- ✅ Department automatically assigned (Water Supply & Sanitation)
- ✅ Priority automatically assigned (Medium/High)
- ✅ WhatsApp notification sent (if Twilio configured)
- ✅ Redirected to home page

### Step 2: View as Admin

1. **Logout** (click profile icon → Logout)

2. **Login as Water Department Admin:**
   - Click "Login"
   - Email: `admin.water@example.com`
   - Password: `admin123`
   - Type: Admin
   - Click "Login"

3. **Check Dashboard:**
   - You should see "Admin Dashboard - Water Supply & Sanitation Department"
   - Check charts:
     - Priority Distribution: Should show the new grievance
     - Department Comparison: Water department count increased
     - Daily Trend: Today's count should increase
   - Recent Grievances: Your new grievance should appear at the top

**Expected Result:**
- ✅ Dashboard shows real-time data
- ✅ New grievance visible in the list
- ✅ Charts reflect the new data
- ✅ Grievance details shown: ID, User, Priority, Status

### Step 3: View Grievance Details

1. **Click "View"** on the grievance you just submitted

2. **Verify details:**
   - Grievance ID matches
   - Citizen name shows "Ramesh"
   - Phone number: +919876543210
   - Department: Water Supply & Sanitation Department
   - Priority: (as assigned by AI)
   - Status: Pending
   - Full grievance text visible
   - Structured summary visible (AI generated)
   - Location details visible

**Expected Result:**
- ✅ All details displayed correctly
- ✅ Phone number visible
- ✅ Structured summary generated by AI
- ✅ Status is "Pending"

### Step 4: Update Status

1. **In the grievance detail page:**
   - Select status: "Under Review"
   - Add note: "Our team has received the complaint. We will inspect the site tomorrow."
   - Click "Update Status"

2. **Check status history:**
   - Should show the update
   - Shows admin name who updated
   - Shows timestamp

**Expected Result:**
- ✅ Status updated successfully
- ✅ WhatsApp notification sent to user (if configured)
- ✅ Status history shows the change
- ✅ Admin name visible in history

### Step 5: Check Admin Profile

1. **Click "Profile"** in navigation

2. **Verify profile shows:**
   - Officer Name: Mr. Vikram Mehta
   - Department: Water Supply & Sanitation Department
   - Position: Department Admin
   - Government Under: State Government
   - Official Email: admin.water@example.com
   - Total Grievances Handled: (count increased)
   - Resolved Grievances: (count)
   - Pending Grievances: (count)

**Expected Result:**
- ✅ All profile fields populated
- ✅ Statistics showing real numbers from database
- ✅ Total count includes the new grievance

---

## Test Scenario 2: Multiple Departments

### Test Health Department

1. **Login as:** `admin.health@example.com` / `admin123`
2. **Check Dashboard:**
   - Should only show Health department grievances
   - Charts filtered to Health department data
3. **Expected:** Water department grievances NOT visible

### Test Infrastructure Department

1. **Login as:** `admin.infrastructure@example.com` / `admin123`
2. **Submit a new grievance** as citizen about potholes
3. **Expected:** Grievance assigned to "Roads & Infrastructure Department"
4. **Verify:** Admin sees it in their dashboard

---

## Test Scenario 3: Empty State

### Test with New Department Admin (no grievances yet)

1. **Create a new admin** for a department with no grievances
2. **Login as that admin**
3. **Check Dashboard:**
   - Should show "No grievances found for your department"
   - Charts show "No data available"
   - No errors

**Expected Result:**
- ✅ Graceful handling of empty data
- ✅ User-friendly messages
- ✅ No console errors

---

## Test Scenario 4: API Direct Testing

### Test Admin Profile API

```bash
# Make sure Flask is running
curl http://localhost:5000/api/admin/profile/1
```

**Expected Response:**
```json
{
  "status": "success",
  "profile": {
    "id": 1,
    "name": "Dr. Rajesh Singh",
    "email": "admin.health@example.com",
    "department": "Public Health Department",
    "position": "Department Admin",
    "governmentUnder": "State Government",
    "totalHandled": 0,
    "resolved": 0,
    "pending": 0
  }
}
```

### Test Dashboard Stats API

```bash
curl http://localhost:5000/api/dashboard/stats/2
```

**Expected Response:**
```json
{
  "status": "success",
  "stats": {
    "priorityData": [...],
    "deptData": [...],
    "trendData": [...],
    "grievances": [...],
    "statusCounts": {...},
    "department": "Water Supply & Sanitation Department"
  }
}
```

### Test Grievances by Department

```bash
curl "http://localhost:5000/api/grievances/department/Water%20Supply%20%26%20Sanitation%20Department"
```

---

## Verification Checklist

After running all tests, verify:

### User Flow
- [ ] User can submit grievance successfully
- [ ] Grievance ID generated and shown
- [ ] WhatsApp notification sent (optional)
- [ ] Grievance saved to database

### Admin Flow
- [ ] Admin can login successfully
- [ ] Dashboard loads with real data
- [ ] Charts display correctly
- [ ] Grievances list shows department-specific items
- [ ] Can view individual grievance details
- [ ] All grievance fields populated (including phone)
- [ ] Can update status
- [ ] Status history tracked
- [ ] Profile page shows correct details
- [ ] Statistics calculated correctly

### Data Integrity
- [ ] Grievances filtered by department
- [ ] Phone numbers stored and displayed
- [ ] AI classification working (department/priority)
- [ ] Date/time stamps correct
- [ ] User names displayed (or "Guest" if not logged in)

### Error Handling
- [ ] Loading states shown
- [ ] Error messages displayed when backend down
- [ ] Empty states handled gracefully
- [ ] Invalid data handled properly

### Performance
- [ ] Dashboard loads quickly
- [ ] No console errors
- [ ] API responses fast (<500ms for most)
- [ ] Charts render smoothly

---

## Common Issues and Solutions

### Issue: Dashboard shows "No grievances"
**Solution:** Submit at least one grievance for that department

### Issue: Admin profile shows zeros
**Solution:** This is correct if no grievances exist for that department yet

### Issue: WhatsApp not sending
**Solution:** System works fine without WhatsApp. Check Twilio credentials if needed.

### Issue: "Failed to connect to server"
**Solution:** Ensure Flask backend is running on port 5000

### Issue: Charts not rendering
**Solution:** Check browser console for errors. Ensure recharts is installed: `npm install`

---

## Performance Benchmarks

**Expected Response Times:**
- Admin Profile API: < 100ms
- Dashboard Stats API: < 300ms
- Grievance Detail API: < 150ms
- Submit Grievance: 2-5 seconds (due to AI processing)

**Database Queries:**
- Should handle 1000+ grievances efficiently
- Dashboard stats: optimized queries with proper indexes

---

## Success Criteria

✅ **All tests pass**
✅ **No console errors**
✅ **No linter errors**
✅ **Data displays correctly**
✅ **Phone numbers visible**
✅ **Department filtering works**
✅ **Statistics accurate**
✅ **UI responsive**

---

**Test Date:** January 24, 2026
**Tested By:** Development Team
**Status:** Ready for Production

